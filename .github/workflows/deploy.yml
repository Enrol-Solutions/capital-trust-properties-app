- name: Deploy to Lightsail
  run: |
    ssh -o StrictHostKeyChecking=no ubuntu@54.179.119.176 'bash -s' << 'EOF'
      set -e

      echo "âœ… SSH connected"

      cd /var/www/capital-trust-properties-app
      git config --global --add safe.directory /var/www/capital-trust-properties-app

      echo "ðŸ“¦ Resetting codebase"
      git reset --hard HEAD
      git clean -fd

      echo "ðŸ“¥ Pulling latest from production"
      git pull origin production

      echo "ðŸ“¦ Installing Composer dependencies"
      composer install --no-interaction --prefer-dist --optimize-autoloader

      echo "âš™ï¸ Running Artisan commands"
      php artisan migrate --force
      php artisan config:cache
      php artisan route:cache
      php artisan view:cache

      echo "ðŸ” Restarting Apache"
      sudo -n systemctl restart apache2

      echo "âœ… Deployment complete"
EOF
